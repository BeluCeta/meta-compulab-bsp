From 71c58149d7072ed4ceeda79eea5c739a7a9d2392 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Fri, 19 Oct 2018 19:03:26 +0300
Subject: [PATCH 83/86] imx8mq: Refactoring wm8731

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/cl-som-imx8.dts      |  4 ++++
 arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi |  4 ++--
 arch/arm64/boot/dts/compulab/sb-ucm-imx8.dtsi     | 11 ++++++-----
 3 files changed, 12 insertions(+), 7 deletions(-)

diff --git a/arch/arm64/boot/dts/compulab/cl-som-imx8.dts b/arch/arm64/boot/dts/compulab/cl-som-imx8.dts
index 34b20fb..549aada 100644
--- a/arch/arm64/boot/dts/compulab/cl-som-imx8.dts
+++ b/arch/arm64/boot/dts/compulab/cl-som-imx8.dts
@@ -56,3 +56,7 @@
 	hard-wired = <1>;
 	status = "okay";
 };
+
+&wm8731 {
+    status = "okay";
+};
diff --git a/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi b/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi
index f3571bb..d28cd67 100644
--- a/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi
+++ b/arch/arm64/boot/dts/compulab/compulab-imx8mq.dtsi
@@ -81,7 +81,7 @@
 			system-clock-direction = "out";
 		};
 
-		simple-audio-card,codec {
+		sound_codec: simple-audio-card,codec {
 			sound-dai = <&wm8731>;
 			system-clock-direction = "in";
 			system-clock-type = "mclk";
@@ -504,7 +504,7 @@
 		#sound-dai-cells = <0>;
 		compatible = "wlf,wm8731";
 		reg = <0x1a>;
-		status = "okay";
+		status = "disabled";
 	};
 
 	eeprom@50 {
diff --git a/arch/arm64/boot/dts/compulab/sb-ucm-imx8.dtsi b/arch/arm64/boot/dts/compulab/sb-ucm-imx8.dtsi
index 8c8a078..9f4005f 100644
--- a/arch/arm64/boot/dts/compulab/sb-ucm-imx8.dtsi
+++ b/arch/arm64/boot/dts/compulab/sb-ucm-imx8.dtsi
@@ -60,20 +60,21 @@
     status = "disabled";
 };
 
-&wm8731 {
-    status = "disabled";
-};
-
 sbc_i2c_lvds: &i2c4 {
     clock-frequency = <400000>;
     pinctrl-names = "default";
     pinctrl-0 = <&pinctrl_i2c4>;
     status = "okay";
 
-	wm8731@1a {
+	wm8731_ucm: wm8731@1a {
 		#sound-dai-cells = <0>;
 		compatible = "wlf,wm8731";
 		reg = <0x1a>;
 		status = "okay";
 	};
+
+&sound_codec {
+    sound-dai = <&wm8731_ucm>;
+};
+
 };
-- 
1.9.1

